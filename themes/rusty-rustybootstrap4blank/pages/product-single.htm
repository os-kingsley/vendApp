title = "Product-single"
url = "/product-single/:slug"
layout = "productlayout"
is_hidden = 0

[commentsPost]

[starrating]


[ssbuttons]
fa = "maxcdn"
twitter = 1
facebook = 1
google+ = 0
stumbleupon = 0
linkedin = 1
order_twitter = 1
order_facebook = 2
order_google+ = 3
order_stumbleupon = 4
order_linkedin = 5
==
<?php
use Corymillz\Adverts\Models\Advert;
use Corymillz\Adverts\Models\Cat;



function onStart() {


if (Session::has('flagpost')) {
$this['query'] = Session::get('flagpost');
}

$slug = $this->param('slug');

$this['adsingles'] = Advert::
withCount(['ratings as rating' => function ($query) {
$query->select(DB::raw('COALESCE(avg(rating), 0)'));
}])
->where('slug',$slug)->remember(60)->first();

$getPostUser = Advert::where('slug', $slug)->first();

if(Auth::getUser() && Auth::getUser()->id == $getPostUser->user_id ){
  
  $this['getuser'] = Auth::getUser();
}


$this['uri'] = Request::path();



$this['count'] = Advert::
with(['ratings' => function ($query) {
$query->count('rating');

}])
->where('slug', $slug)->groupBy('user_id')->first();




$advert = Advert::where('slug', $slug)->first();

$advert->increment('view_count');

$this['page'] = $advert->fresh()->view_count;

$flagged = $advert->fresh()->flag;


  




$this['adsimage'] = Advert::with('allimage')->where('slug',$slug)->get();




}


function onBookmark()
{
 
$recordId = post('bookmark');

$record = Advert::find($recordId);

$user=  Auth::getUser();

$user->ads()->syncWithoutDetaching($record);
Flash::success('Successfully Added!');




}

function onReport()
{
 
$recordId = post('adverts');
Session::put('flagpost', $recordId);
$adCount = Advert::where('id', $recordId)->first();
$adCount->increment('flag');
$adCount->fresh()->flag;


Flash::success('Successfully Flagged!');
return Redirect::back();



}






?>
==


{% if user %}

 <a class="float-left d-xl-none" style=" margin-top: 20px; margin-left: 20px; text-decoration: none;"  href="#"  data-request ="onBookmark"  data-request-confirm="Add to Favourite" data-request-data= "bookmark: {{ adsingles.id }}"  data-request-flash><span style="font-size: 20px; color: grey" class="fa fa-heart-o"></span> <span style="font-size: 16px; font-family: arial; color: black; ">Add to Favourite List</span></a>
 {% else %}

  <a class="float-left d-xl-none" style=" margin-top: 20px; margin-left: 20px; text-decoration: none;"  href="#"   onclick="$.oc.flashMsg({text: 'Log in to Favourite a Produt/Servce', 'class': 'error'}); return false;"><span style="font-size: 20px; color: grey" class="fa fa-heart-o"></span> <span style="font-size: 16px; font-family: arial; color: black; ">Add to Favourite List</span></a>
  {% endif %}


<div class="d-xl-none">
{% partial "product-details/product-details-pics" %}
{% if getuser and inGroup('seller') %}
<div class="container" align="right">
<a  href="{{ 'post-edit'|page ({ slug: adsingles.slug }) }}"><small style="color: grey;"><span class="fa fa-edit"></span> Edit</small>
</a>
</div><br>
{% endif %}
{% partial "product-details/product-rvc" %}
<br>

<div align="left" style="  color: white; font-size: 25px; color: #08172A; font-family: arial; margin: 20px; margin-top:-20px; ">{{ adsingles.title }}

</div>
</div>





<div class="container d-xl-none" style="font-family: arial; margin-top: -20px" ><br>
  <h5 style="color: darkcyan;">{% if adsingles.price %}₦{{ adsingles.price }} {% else %}<span class="badge">Contact for Price</span>{% endif %}<span> 

    {% set foo = adsingles.user.payment_id %}

    <a {% if foo %}  href="myModal1" {% else %}  href="myModal3" {% endif %} style="border-radius: 5px; font-family: arial; font-size: 13px; background-color: teal;" role="button" class="btn btn-sm text-light col-6 shadow float-right" {% if foo %} data-toggle="modal" data-target="#myModal1" {% else %} data-toggle="modal" data-target="#myModal3" {% endif %}><span class="fa fa-money"></span> Payment Options</a></h5>
    <hr>



    <div align="left" style="margin-top: -2px", ><small><span style="color: black"><span class="fa fa-map-marker" style="color: grey"></span> {{ adsingles.location|truncate(20) }}</span></small><span class="float-right" align="right" style="margin-top: -2px; width: 50%; max-height: 50%" ><small><span  style="color: grey"></span><a style="color: #1484B3; text-decoration: none" href="{{ 'seller-profile'|page ({ id: adsingles.user.id }) }}">{{ adsingles.user.company|truncate(20) }}</a></small></span></div> 

    


  </div>

  {% if adsingles.delivery == 'Yes' %}
  
  <div class="d-xl-none" align="left" style="margin-top: 20px">
<hr>
  <span style="color: black; margin-top: 20px; margin-left: 20px; font-family: arial; font-size: 14px"> Delivery Available</span> <img style="height: 23px; width: auto; margin-left: 0px; margin-top: -10px" src="{{ 'assets/images/truck.png'|theme }}">


   {% if adsingles.delivery_time and adsingles.delivery_time > 0 %}

   <span class="float-right" align="right" style="margin-top: -2px; width: 50%" ><span style="font-size: 20px; margin-top: -30px; margin-right: 5px" class="fa fa-clock-o"></span><span style="margin-right: 10px; margin-top: -20px; font-family: arial; font-size: 15px" ><span style="color: grey">Within</span> {{ adsingles.delivery_time }}</span></span>
   {% endif %}
 </div>
 
 {% endif %} <div class="d-xl-none"><hr></div>
 {% if user %}
<div class="d-xl-none" style="margin-left: 20px; font-size: 15px; font-family: arial">Rate this Product/Service &nbsp{% component 'starrating' %}</div><br>

{% endif %}

<div class="d-xl-none container">
 {% partial "product-details/accord"%}


<br>

</div>


  <div class="container d-xl-none">
    <div class="starter-template" style="margin: -25px">
{% if user %}
{% if query != adsingles.id %}
<a style="color: grey; font-size: 14px;font-family: arial" href="#"  data-request ="onReport" data-request-confirm="Flag this Product/Service"  data-request-data= "adverts: {{ adsingles.id }}" data-request-flash>
<span class=" fa fa-flag" style="color: red;"></span> Flag this Product/Service</a>
<br><br>
{% endif %}
{% else %}
<a style="color: grey; font-size: 14px;font-family: arial" href="#"   onclick="$.oc.flashMsg({text: 'Log in to Flag a Produt/Servce', 'class': 'error'}); return false;">
<span class=" fa fa-flag" style="color: red;"></span> Flag this Product/Service</a>
<br><br>
{% endif %}
      <small>Share on:</small>
    {% component 'ssbuttons' %}

</div>
</div>

{% partial 'product-details/contact-nav' %}

{% partial 'product-details/payment-option' %}

{% partial 'product-details/message-option' %}





{% partial 'product-details/not-activated' %}


{% partial 'product-details/review' %}

{% partial 'product-details/report' %}


























<!--
desktop view
  -->
  <div class="d-none d-xl-block">
    
  <div align="right" style="margin: 20px; margin-top: -30px;">
    <span class="float-left" style="width: 40%">
    {% partial "product-details/product-details-pics-desktop" %}
</span>
    <div align="left">
      <span style="color: white; font-size: 27px; color: #08172A; font-family: arial; margin: 20px; margin-top:-20px; font-weight: bold;">{{ adsingles.title }}
      </span><br><br>

      <span style="color: darkcyan; margin-left: 20px; font-size: 19px">{% if adsingles.price %}₦{{ adsingles.price }} {% else %}<span class="badge">Contact for Price</span>{% endif %}</span><br>

      <span style="color: grey; margin-left: 20px; font-family: arial">Seller: <span>{{ adsingles.user.company }}</span></span><br>
      

      <span style="margin-left: 20px">
        {{ adsingles.location }}
      </span><br><br>


{% if adsingles.delivery == 'Yes' %}
<span style="color: black; margin-top: -10px; margin-left: 20px; font-family: arial; font-size: 14px"> Delivery Available</span> <img style="height: 23px; width: auto; margin-left: 0px; margin-top: -10px" src="{{ 'assets/images/truck.png'|theme }}"><br>

{% endif %}

{% if adsingles.delivery_time %}

   <span align="right" style="margin-top: -2px" ><span style="font-size: 20px; margin-top: 7px; margin-left: 20px" class="fa fa-clock-o"></span><span style="margin-right: 10px; margin-top: -20px; font-family: arial; font-size: 15px" > <span style="color: grey">Within</span> {{ adsingles.delivery_time }}</span></span>
   {% endif %}<br><br>

   <a style="background-color: darkcyan; color: white;margin-left: 20px" role="button" class="btn shadow col-3 showNumber" ><span class="fa fa-phone"></span>&nbsp;View Phone Number</a><br><br>

<input style="display: none;" type="text" value="{{ adsingles.user.phone }}" class="phonenum">

  <a style="margin-left: 20px" href="#myModaldesktop" role="button" class="btn btn-success shadow col-4" data-toggle="modal" data-target="#myModaldesktop"><span class="fa fa-envelope"></span> Message</a><br><br>


</div>
  </div>  

  </div>
<div align="center" class="d-none d-xl-block">
  <div style="margin-left: 20px; margin-top: 30px">
       {% partial "product-details/product-rvc" %} 
      </div>

      {% if user %}
      <div style="margin-left: 20px; font-size: 15px; font-family: arial">Rate this Product/Service &nbsp
 

<select id="backing3" data-request-confirm="Rate this Product/Service" data-request="onStar" data-request-data="rate:{{ adsingles.id }}"  name="star" >
  
    <option value="1">Poor</option>
    <option value="2">Ok</option>
    <option value="3">Good</option>
    <option value="4">Great</option>
    <option value="5">Excellent</option>
</select>
<div class="rateit" data-rateit-backingfld="#backing3"  data-rateit-mode="font"></div>
      </div>
{% endif %}
<br>

{% if getuser and inGroup('seller') %}
<div class="container" align="right">
<a  href="{{ 'post-edit'|page ({ slug: adsingles.slug }) }}"><small style="color: grey;"><span class="fa fa-edit"></span> Edit</small>
</a>
</div><br>
{% endif %}
{% if not user%}
<br>
{% endif %}
</div><br>
<div align="center" class="d-none d-xl-block">


    {% set foo = adsingles.user.payment_id %}

    <a {% if foo %}  href="myModal11" {% else %}  href="myModal311" {% endif %} style="border-radius: 5px; font-family: arial; font-size: 13px; background-color: teal;" role="button" class="btn btn-sm text-light col-4 shadow" {% if foo %} data-toggle="modal" data-target="#myModal11" {% else %} data-toggle="modal" data-target="#myModal311" {% endif %}><span class="fa fa-money"></span> Payment Options</a></h5><br><br><br><br><br><br><br>

   <div class="container" style="margin-top: -100px;"> {% partial "product-details/accord-desktop"%}</div>
<br><br><br><br>

     <div class="container">
    <div class="starter-template" style="margin: -25px">
     {% if user %}
{% if query != adsingles.id %}
<a style="color: grey; font-size: 14px;font-family: arial" href="#"  data-request ="onReport" data-request-confirm="Flag this Product/Service"  data-request-data= "adverts: {{ adsingles.id }}" data-request-flash>
<span class=" fa fa-flag" style="color: red;"></span> Flag this Product/Service</a>
<br><br>
{% endif %}
{% else %}
<a style="color: grey; font-size: 14px;font-family: arial" href="#"   onclick="$.oc.flashMsg({text: 'Log in to Flag a Produt/Servce', 'class': 'error'}); return false;">
<span class=" fa fa-flag" style="color: red;"></span> Flag this Product/Service</a>
<br><br>
{% endif %}

      <small>Share on:</small>
    {% component 'ssbuttons' %}


</div>
</div>
</div>



<!--
end
-->


<div class="d-none d-xl-block">
{% partial 'Footer'%}
</div>

{% partial 'product-details/payment-desktop' %}
{% partial 'product-details/not-activated-desktop' %}
{% partial 'product-details/message-option-desktop' %}




{% put styles %}
     <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  
{% endput %}





{% put scripts %}
<script type="text/javascript" src="/plugins/saurabhdhariwal/comments/assets/js/comments.js"></script>
{% endput %}


{% put scripts %}
<script>
    $(window).on('ajaxConfirmMessage', function(event, message) {
        // Stop the default confirm dialog
        event.preventDefault();    

        // open our own bootstrap modal
        $('#bookmarkModal').modal('show'); 
         $(".result").html(message);
        // Okay Buttossn. we will unbind if any events are attached to it first
        // reattach click event - this is required as this code will call each time
        $('#okay-button').unbind().click(function() {        
            // hide modal
            $('#bookmarkModal').modal('hide'); 
            // Resolve the deferred object, this will trigger whatever was being confirmed
            event.promise.resolve();
        });

        // Cancel Button
        $('#cancel-button').unbind().click(function() {        
            // hide modal
            $('#bookmarkModal').modal('hide'); 
            // Reject the object, this will cancel whatever was being confirmed            
            event.promise.reject();        
        });

        // Return a value so the framework knows we're handling the confirm
        return true;
    });
</script>


<script type="text/javascript">
  $(function(){
  $(".showNumber").click(function(event){
    var phone = $('.phonenum').val();
    $('.showNumber').html(phone);
   // e.target.innerHTML = e.target.parent.querySelector('.phonenum').value;
  });
});
</script>

  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
  $( function() {
    $( "#accordion" ).accordion({
      heightStyle: "content"
    });
  } );
  </script>

  <script>
  $( function() {
    $( "#accordiondesk" ).accordion({
      heightStyle: "content"
    });
  } );
  </script>
{% endput %}





