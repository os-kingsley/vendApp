title = "Manage Buy Request"
url = "/manage-buy-request/:slug"
layout = "default"
is_hidden = 0

security = "user"
redirect = "login"
==

<?php
use Corymillz\Adverts\Models\Buy;

function onStart(){


$slug = $this->param('slug');

$this['requests'] = Buy::where('user_id', $slug)->orderby('created_at','desc')->paginate(10);
	

}




function onDelete()
{
$recordId = post('record');
$record = Buy::find($recordId)->delete();
Flash::success('Successfully Deleted!');
return Redirect::back();

}




?>

==

<b><h6 align="center"  class="p-3 mb-2 text-white shadow" style="margin-top: -15px; background-color: #1484B3">Manage Buy Request</h6></b><br>

<div style="font-family: arial; font-size: 14px" class="container">
  <div class="starter-template" style="margin: -40px">

 <table class="table table-striped">
  <thead>
    <tr>
      
      <th scope="col">#</th>
      <th scope="col">Posted Buy Requests</th>
         <th scope="col">Manage</th>
        
  </tr>
  </thead>
{% set counter = 0 %}
  <tbody>
  	 {% for request in requests %}
  	 {% set counter = counter + 1 %}
  	    <tr>

  	    	 <th scope="row">{{ counter }}</th>
     
      <td><a style="color:  #08172A; text-decoration: none;" href="{{ 'buy-request-single'|page({ slug: request.slug }) }}">{{ request.title }}</a></td>

     
     
      <td> <a href="{{ 'buy-request-edit'|page ({ slug: request.slug }) }}"><button class="btn btn-sm btn-outline-success">Edit</button></a></td>

      <td> <button type="button" class="btn btn-sm btn-outline-danger" data-request ="onDelete" data-request-confirm="Are you sure?"  data-request-data= "record: {{ request.id }}">Delete</button></td>
      
     
     
      
     
    </tr>
{% else %}

<div><p style="color: grey"> No Buy Request Posted</p></div>
    


    {% endfor %}


   

  </tbody>

</table>








<nav aria-label="Page navigation example" style="font-size: 17px;">
  {% if requests.hasPages %}
  <ul class="pagination justify-content-center">

    {% if requests.currentPage > 1 %}
    <li class="page-item">
      <a class="page-link" href="{{ requests.previousPageUrl }}" rel="prev" ><span class=" fa fa-arrow-left"></span></a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="true"><span class=" fa fa-arrow-left"></span></a>
    </li>
    
    {% endif %}
    


{% if requests.currentPage > 3 %}
 <li class="page-link"><a href="{{ requests.url(1) }}">1</a></li>
{% endif %}

{% if requests.currentPage > 4 %}
  <li class="page-link"><span>...</span></li>
{% endif %}





    {% for page in range(1, requests.lastPage) %}
   {% if page >= requests.currentPage - 2 and page <= requests.currentPage + 2 %}
   {% if page == requests.currentPage %}
    <li class="page-item active"><a class="page-link">{{ page }}</a></li>
               {% else %}
                    <li class="page-link"><a href="{{ requests.url(page) }}">{{ page }}</a></li>
    {% endif %}
    {% endif %}
   

     {% endfor %}

{% if requests.currentPage < requests.lastPage - 3 %}
<li class="page-link"><span>...</span></li>
{% endif %}

{% if requests.currentPage < requests.lastPage - 2 %}
 <li class="page-link"><a href="{{ requests.url(requests.lastPage) }}">{{ requests.lastPage }}</a></li>
{% endif %}

 {% if requests.hasMorePages %}
    
    <li class="page-item">
      <a class="page-link" href="{{ requests.nextPageUrl }}"><span class=" fa fa-arrow-right"></span></a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="true"><span class=" fa fa-arrow-right"></span></a>
    </li>
    {% endif %}

      

  </ul>
  {% endif %}
</nav>
 







</div>
</div>






</div>
</div>






<div class="modal fade" id="delectModal" tabindex="-1" role="dialog" aria-labelledby="delectModal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered " role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="delectModal" style="font-family: arial">Delete Posted Ad</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p align="center" style="font-size: 20px; font-family: arial; font-weight: bold; color: grey; font-family: arial">Are You Sure?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancel-button">Cancel</button>
        <button type="button" class="btn btn-primary" id="okay-button">Ok</button>
      </div>
    </div>
  </div>
</div>



{% put scripts %}
<script>
    $(window).on('ajaxConfirmMessage', function(event, message) {
        // Stop the default confirm dialog
        event.preventDefault();    

        // open our own bootstrap modal
        $('#delectModal').modal('show'); 

        // Okay Button. we will unbind if any events are attached to it first
        // reattach click event - this is required as this code will call each time
        $('#okay-button').unbind().click(function() {        
            // hide modal
            $('#delectModal').modal('hide'); 
            // Resolve the deferred object, this will trigger whatever was being confirmed
            event.promise.resolve();
        });

        // Cancel Button
        $('#cancel-button').unbind().click(function() {        
            // hide modal
            $('#delectModal').modal('hide'); 
            // Reject the object, this will cancel whatever was being confirmed            
            event.promise.reject();        
        });

        // Return a value so the framework knows we're handling the confirm
        return true;
    });
</script>
{% endput %}